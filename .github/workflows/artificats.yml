name: 02 Variables Secrets and Artifacts

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  GLOBAL_VAR: "Global Level Variable"

jobs:
  build-and-upload:
    runs-on: ubuntu-latest
    env:
      JOB_VAR: "Job Level Variable"
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install Dependencies
        working-directory: ./client
        run: npm ci

      - name: Build Application
        working-directory: ./client
        run: npm run build
        env:
          # Demonstrating environment variable usage
          VITE_APP_API_URL: ${{ vars.API_URL || 'https://api.example.com' }}

      - name: Use Variables and Secrets
        run: |
          echo "Global Var: $GLOBAL_VAR"
          echo "Job Var: $JOB_VAR"
          echo "Step Var: $STEP_VAR"
          echo "Repo Var: ${{ vars.REPO_VAR }}" 
          echo "Secret (Masked): ${{ secrets.MY_SECRET }}"
        env:
          STEP_VAR: "Step Level Variable"
      
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: client-build
          path: ./client/dist
          retention-days: 1

  download-and-verify:
    needs: build-and-upload
    runs-on: ubuntu-latest
    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: client-build
          path: ./downloaded-client

      - name: Verify Artifact Content
        run: |
          ls -R ./downloaded-client
